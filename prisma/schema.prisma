// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id                 String     @id @default(cuid())
  title              String
  description        String?
  timezone           String     // IANA timezone (e.g., "Asia/Shanghai")
  startDate          DateTime   // UTC
  endDate            DateTime   // UTC
  mode               String     @default("timeRange") // "timeRange" or "fullDay"
  timeMode           String     @default("standard")  // "standard", "period", or "custom"
  dayStartTime       String?    // HH:mm format (e.g., "09:00"), for standard mode
  dayEndTime         String?    // HH:mm format (e.g., "22:00"), for standard mode
  slotMinutes        Int?       // 15, 30, or 60, for standard mode
  minDurationMinutes Int?       // minimum meeting duration, for standard mode
  customTimeSlots    Json?      // for custom mode: [{label: "下午 4-5", startTime: "16:00", endTime: "17:00"}]
  adminToken         String     @unique
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  responses          Response[]

  @@index([adminToken])
}

model Response {
  id                String   @id @default(cuid())
  eventId           String
  event             Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  name              String?  // participant name (optional)
  availabilitySlots Int[]    // array of slot indices
  sessionToken      String   @unique // for allowing edits from same device
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([eventId])
  @@index([sessionToken])
}
