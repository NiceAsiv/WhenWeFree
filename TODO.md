# WhenWeFree 开发任务清单

## 🎯 近期任务 (P0 - 高优先级)

### 活动管理功能

#### 活动编辑
- [ ] 设计活动编辑 UI 界面
- [ ] 实现编辑权限验证（adminToken）
- [ ] 创建编辑 API 端点
  - [ ] `PATCH /api/events/[eventId]`
  - [ ] 支持编辑标题、描述
  - [ ] 支持调整日期范围
- [ ] 添加编辑历史记录功能
- [ ] 编写测试用例
- [ ] 更新文档

#### 活动删除/归档
- [ ] 实现软删除机制
  - [ ] 在 schema 中添加 `deletedAt` 字段
  - [ ] 在 schema 中添加 `status` 字段 (active/archived/deleted)
- [ ] 创建删除 API
  - [ ] `DELETE /api/events/[eventId]`
- [ ] 实现归档功能
  - [ ] 自动归档过期活动（可配置天数）
  - [ ] 手动归档功能
- [ ] 创建恢复功能界面
- [ ] 编写测试用例

#### 活动复制
- [ ] 设计复制活动流程
- [ ] 创建复制 API
  - [ ] `POST /api/events/[eventId]/duplicate`
  - [ ] 复制活动设置，不复制参与者回复
- [ ] 添加"创建类似活动"按钮
- [ ] 编写测试用例

### 最终时间确认

#### 确认机制
- [ ] 设计确认时间的 UI
  - [ ] 在结果页面添加"确认这个时间"按钮
  - [ ] 管理员专属功能
- [ ] 数据库 schema 更新
  - [ ] 添加 `confirmedSlots` 字段到 Event 模型
  - [ ] 添加 `confirmedAt` 时间戳
- [ ] 创建确认 API
  - [ ] `POST /api/events/[eventId]/confirm`
- [ ] 实现锁定状态显示
  - [ ] 在结果页显示已确认的时间
  - [ ] 添加确认状态标识

#### 通知功能
- [ ] 设计邮件通知模板
  - [ ] 时间确认通知
  - [ ] 活动更新通知
- [ ] 实现邮件发送服务
  - [ ] 选择邮件服务提供商（SendGrid/Resend）
  - [ ] 配置邮件模板
- [ ] 创建通知 API
  - [ ] `POST /api/events/[eventId]/notify`
- [ ] 添加批量通知功能
- [ ] 编写测试用例

#### 日历邀请
- [ ] 实现 .ics 文件生成
  - [ ] 安装 ical-generator 库
  - [ ] 创建日历事件生成器
- [ ] 创建下载端点
  - [ ] `GET /api/events/[eventId]/calendar`
- [ ] 添加"添加到日历"按钮
- [ ] 支持多种日历格式
  - [ ] Google Calendar
  - [ ] Outlook
  - [ ] Apple Calendar
- [ ] 编写测试用例

### 移动端体验优化

#### 触摸交互
- [ ] 优化时间网格触摸响应
  - [ ] 改进拖拽选择体验
  - [ ] 添加触摸反馈
- [ ] 实现长按菜单
  - [ ] 快速选择整行/列
  - [ ] 复制/粘贴时间
- [ ] 添加手势支持
  - [ ] 双指缩放时间网格
  - [ ] 滑动切换日期
- [ ] 优化按钮大小和间距
- [ ] 测试多种设备和屏幕尺寸

#### 布局优化
- [ ] 优化时间网格在小屏幕上的显示
  - [ ] 自适应列宽
  - [ ] 可滚动区域优化
- [ ] 固定底部操作栏
  - [ ] 提交按钮始终可见
  - [ ] 显示已选数量
- [ ] 优化表单输入体验
  - [ ] 更大的输入框
  - [ ] 更好的键盘处理
- [ ] 响应式导航
- [ ] 编写测试用例

#### 性能优化
- [ ] 虚拟滚动实现（大量时间段时）
- [ ] 图片懒加载
- [ ] 减少重渲染
  - [ ] memo 优化组件
  - [ ] useCallback 优化回调
- [ ] 代码分割和懒加载
- [ ] 性能监控和优化

### 活动模板系统

#### 预设模板
- [ ] 设计模板数据结构
  ```typescript
  interface EventTemplate {
    id: string;
    name: string;
    description: string;
    mode: 'timeRange' | 'fullDay';
    timeMode: 'standard' | 'period' | 'custom';
    defaultSettings: {
      dayStartTime?: string;
      dayEndTime?: string;
      slotMinutes?: number;
      // ...
    };
    category: string;
    icon: string;
  }
  ```
- [ ] 创建预设模板
  - [ ] 团队会议模板
  - [ ] 面试安排模板
  - [ ] 团建活动模板
  - [ ] 聚餐模板
  - [ ] 学习小组模板
- [ ] 实现模板选择界面
  - [ ] 在创建活动时显示模板选择
  - [ ] 按类别分组显示
- [ ] 应用模板逻辑
  - [ ] 一键填充表单
  - [ ] 允许用户修改
- [ ] 编写测试用例

#### 自定义模板
- [ ] 数据库 schema 更新
  - [ ] 创建 UserTemplate 模型
  - [ ] 关联用户（需要账户系统）
- [ ] 保存为模板功能
  - [ ] 在创建活动后提供"保存为模板"选项
  - [ ] 创建保存 API
- [ ] 管理自定义模板
  - [ ] 列表页面
  - [ ] 编辑/删除功能
- [ ] 模板分享（可选）
  - [ ] 公开模板库
  - [ ] 社区模板
- [ ] 编写测试用例

---

## 🔜 下一阶段任务 (P1 - 重要功能)

### 用户账户系统
- [ ] 设计数据库模型
  - [ ] User 模型
  - [ ] Session 模型
  - [ ] 关联 Event 和 User
- [ ] 选择认证方案
  - [ ] NextAuth.js / Clerk / Supabase Auth
- [ ] 实现注册/登录
  - [ ] 邮箱验证
  - [ ] 密码加密
- [ ] 个人中心页面
  - [ ] 我创建的活动
  - [ ] 我参与的活动
- [ ] 权限管理系统
- [ ] 迁移现有数据

### 管理员功能增强
- [ ] 参与者管理界面
  - [ ] 查看所有参与者
  - [ ] 删除参与者回复
  - [ ] 编辑参与者信息
- [ ] 批量操作
  - [ ] 批量删除
  - [ ] 批量通知
- [ ] 活动统计
  - [ ] 参与率
  - [ ] 响应时间
- [ ] 导出功能
  - [ ] CSV 导出
  - [ ] Excel 导出

### 邮件通知系统
- [ ] 配置邮件服务
  - [ ] 选择服务商（SendGrid/Resend）
  - [ ] API 配置
- [ ] 邮件模板设计
  - [ ] 活动邀请
  - [ ] 参与提醒
  - [ ] 时间确认
  - [ ] 活动更新
- [ ] 实现发送逻辑
  - [ ] 异步队列处理
  - [ ] 重试机制
- [ ] 用户偏好设置
  - [ ] 允许取消订阅
  - [ ] 通知频率设置

### 结果导出功能
- [ ] PDF 导出
  - [ ] 使用 jsPDF 或 puppeteer
  - [ ] 设计 PDF 模板
- [ ] 图片导出
  - [ ] html-to-image
  - [ ] 可分享的结果卡片
- [ ] 数据导出
  - [ ] JSON 格式
  - [ ] CSV 格式
- [ ] 导出预览功能
- [ ] 下载管理

### 时间选择器改进
- [ ] 快捷选择功能
  - [ ] 选择整个上午
  - [ ] 选择整个下午
  - [ ] 选择整个晚上
  - [ ] 选择全天
  - [ ] 选择工作时间
- [ ] 批量操作
  - [ ] 复制某天到其他天
  - [ ] 清除某天
  - [ ] 反选
- [ ] 撤销/重做
  - [ ] 实现操作历史栈
  - [ ] Ctrl+Z / Ctrl+Y 快捷键
- [ ] 键盘导航
  - [ ] 箭头键移动
  - [ ] Space 选择/取消选择
- [ ] 视觉反馈改进
  - [ ] 悬停效果
  - [ ] 选中动画
  - [ ] 提示信息

---

## 📋 后续规划 (P2/P3)

### 多管理员协作
- [ ] 添加共同管理员功能
- [ ] 权限级别设计
- [ ] 邀请机制
- [ ] 操作日志

### 评论讨论功能
- [ ] 评论系统数据模型
- [ ] 实时评论功能
- [ ] @提及功能
- [ ] 评论通知

### 数据分析统计
- [ ] 统计面板设计
- [ ] 数据收集埋点
- [ ] 可视化图表
- [ ] 导出报告

### 日历集成
- [ ] Google Calendar API
- [ ] Outlook API
- [ ] 双向同步
- [ ] 冲突检测

### API 开放
- [ ] RESTful API 设计
- [ ] API 文档
- [ ] 认证机制（API Key）
- [ ] Rate limiting
- [ ] Webhook 支持

### 国际化扩展
- [ ] 添加更多语言
- [ ] 本地化测试
- [ ] RTL 支持
- [ ] 区域设置

### 性能和安全
- [ ] Redis 缓存
- [ ] CDN 配置
- [ ] Rate limiting
- [ ] CAPTCHA
- [ ] 数据加密
- [ ] 定期备份

---

## 🐛 已知问题和改进

### 修复
- [ ] 检查并修复移动端布局问题
- [ ] 优化大量时间段时的性能
- [ ] 修复时区转换边界情况
- [ ] 改进错误处理和提示

### 技术债务
- [ ] 代码重构和优化
- [ ] 添加单元测试
- [ ] 添加 E2E 测试
- [ ] 改进 TypeScript 类型定义
- [ ] 代码注释和文档

### 可访问性
- [ ] 添加 ARIA 标签
- [ ] 键盘导航优化
- [ ] 屏幕阅读器支持
- [ ] 高对比度模式
- [ ] 字体大小可调

---

## 📊 进度跟踪

### 第一季度 (2026 Q1)
**目标**: 完成 P0 任务
- [ ] 活动管理功能 (0/3)
- [ ] 最终时间确认 (0/3)
- [ ] 移动端优化 (0/3)
- [ ] 活动模板 (0/2)

### 第二季度 (2026 Q2)
**目标**: 完成 P1 任务
- [ ] 用户账户系统
- [ ] 管理员功能
- [ ] 邮件通知
- [ ] 结果导出
- [ ] 选择器改进

### 长期规划
- [ ] P2 功能实现
- [ ] P3 功能实现
- [ ] 持续优化和迭代

---

**最后更新**: 2026-01-27  
**状态**: 规划中  
**负责人**: Development Team
